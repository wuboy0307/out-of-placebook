select channels.* from channels
inner join
  (select COUNT(users.id), channels.id from channels
  inner join
    channel_subs on channels.id = channel_subs.channel_id
  inner join
    users on channel_subs.participant_id = users.id
  group by channels.id
  having COUNT(users) = 2) direct_channels
on channels.id = direct_channels.id
inner join
  channel_subs csone on direct_channels.id = csone.channel_id
inner join
  users uone on csone.participant_id = uone.id
inner join
  channel_subs cstwo on direct_channels.id = cstwo.channel_id
inner join
  users utwo on cstwo.participant_id = utwo.id
where (uone.id = ? and utwo.id = ?) OR (uone.id = ? and utwo.id = ?)
